#!/bin/sh

UPS_SHELL=sh;  export UPS_SHELL

if [ X$MCP_DIR = X"" ]; then
    echo 'Please set the MCP version with the setup command' >2
    exit 1
fi

if [ ! -d $MCP_DIR ]; then
    echo "Directory $MCP_DIR doesn't exist" >2
    exit 1
fi
umask 002

cd /p/mcpbase

#
# Make the links for the MCP directories
#
for d in ab bin doc etc fiducial-tables ip mcp-new mei-new params util; do
    if [ -l $d ]; then 
	rm $d
    fi

    if [ -d $MCP_DIR/$d ]; then
	ln -s $MCP_DIR/$d $d
    fi
done
#
# And for required products
#
for d in ASTRODA MURMUR_CLIENT_VX VX_TOOLS; do
    ld=`echo $d | tr A-Z a-z`
    if [ X`eval echo \$''${d}_DIR` = X"" ]; then
	echo "Please setup $ld and try again" >&2
	exit 1
    fi

    if [ -l $ld ]; then 
	rm $ld
    fi

    eval ln -s \$''${d}_DIR ./$ld
done

#
# Check the IP addresses in the mcp.login script
#
code=0
for host in sdsshost tcc25m utc-time; do
    ip=`awk "/hostAdd .$host\.apo\.nmsu\.edu/ { print \\$3 }" etc/mcp.login`
    ns_ip=\"`nslookup $host.apo.nmsu.edu | awk 'NR==5 { print $2}'`\"
    if [ $ip != $ns_ip ]; then
       echo "$host: IP in mcp.login $ip != IP from nslookup $ns_ip" >&2
       code=1
    fi
done

./bin/showMCP

exit $code
